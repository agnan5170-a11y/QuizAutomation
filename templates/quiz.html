{% extends "base.html" %}
{% block content %}
<h3>Quiz for {{ username }}</h3>
<p class="text-muted">Total questions: {{ total }}</p>
<p><strong>Time Left: <span id="timer">10:00</span></strong></p>

<form method="post" action="{{ url_for('submit_quiz') }}">
  <input type="hidden" name="username" value="{{ username }}">
  <input type="hidden" name="question_ids" value="{{ question_ids }}">

  {% for q in questions %}
    <div class="card mb-3">
      <div class="card-body">
        <h5>Q{{ loop.index }}. {{ q['text'] }}</h5>

        {% if q['qtype'] == 'MCQ' %}
          <div class="mt-2">
            {% for opt_key in ['option_a','option_b','option_c','option_d'] %}
              {% if q[opt_key] %}
              <div class="form-check">
                <input class="form-check-input" type="radio"
                       name="q_{{ q['id'] }}" value="{{ opt_key[-1]|upper }}">
                <label class="form-check-label">
                  {{ q[opt_key] }}
                </label>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        {% else %}
          <input type="text" class="form-control mt-2"
                 name="q_{{ q['id'] }}" placeholder="Your answer">
        {% endif %}
      </div>
    </div>
  {% endfor %}

  <button class="btn btn-success">Submit</button>
</form>
{% endblock %}

{% block scripts %}
<script>
  // Simple 10-minute countdown
  let seconds = 10 * 60;
  const timerEl = document.getElementById("timer");

  function updateTimer() {
    const min = String(Math.floor(seconds / 60)).padStart(2, "0");
    const sec = String(seconds % 60).padStart(2, "0");
    timerEl.textContent = `${min}:${sec}`;
    if (seconds > 0) {
      seconds--;
      setTimeout(updateTimer, 1000);
    } else {
      document.forms[0].submit();
    }
  }
  updateTimer();
</script>
{% endblock %}
<!-- Template: quiz.html -->
